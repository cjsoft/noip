# 2393 公式编辑器   
### 时间限制： 1 s&nbsp;&nbsp;&nbsp;&nbsp;空间限制： 64000 KB&nbsp;&nbsp;&nbsp;&nbsp;题目等级： 大师  
## 题目描述：  

<pre>
编辑数学公式总是一件烦人的事情，为此HURRICANE小组准备出一个编辑数学公式的软件。除了基本功能外，软件还将实现分式和矩阵输入。按照设想，软件应该是符合人性化设计的，必须最大限度的方便用户输入，尽管代价是软件开发极其复杂。幸好输入的方式和格式都已定好，你只需要编个处理程序就行了，下面是相关的约定和格式：
 
【格式控制的概念】
 




元素


元素可以是运算符、括号、数字、字母、矩阵、分式。




数字、字母和括号


数字包括’0’..’9’、’.’。字母包括’A’..’Z’，’a’..’z’。括号包括’（’，’）’。它们都只占一行，该行也是对齐行。




表达式


由0个到至多500个元素构成的序列。其中矩阵与分式元素总个数最多不超过30个。




编辑框


一个输入表达式的矩形区域。每一个编辑框都包括一个对齐行用作编辑框相互之间的对齐。且我们定义编辑框的宽度为最长一行的字符个数，例如表达式空的时候为0，高度为最高行与最低行之间相差的行数（包括），但最小为1，即使表达式为空。




对齐行


编辑框或元素中某一特定行。该行用于框内对齐表达式及框间对齐，对齐时需要使表达式中的元素的对齐行位于编辑框的对齐行上。




运算符


有’+’、’-’、’*’、’/’四个，为了区分“-”（减号）与分数线，“-”两边分别加上一个空列。




矩阵


一个（,_）的矩阵包含个编辑框将矩阵分为了m个编辑列和n个编辑行。在矩阵的同一编辑行中，相邻的两个编辑框按编辑框的对齐行对齐，同一编辑列的编辑框按照它们的宽度居中对齐。且必须保证行与行之间至少存在一个空行，列与列之间至少存在一个空列。第一列左边与最后一列右边每行各有一个“[”和“]”，位于各行表达式的对齐行上，如图所示：
 




图形表示

 



文本表示
 


          612
[  456   -----]     -第一编辑行的对齐行
          123
                    -空行、整个矩阵的对齐行
  65535
[-------  234 ]     -第二编辑行的对齐行
    1
  -----
   255




若矩阵的编辑行数n为奇数，则矩阵的对齐行为中间那行编辑行中编辑框的对齐行，否则为中间两个编辑行之间的空行；




分式


分式由分子和分母两个编辑框以及它们之间的分数线组成。分式分数线为一条由“-”组成的字符序列，同时它也是分式的对齐行。分式的宽度为两个编辑框宽度的最大值加2，即在左右两边分别加上一个“-”；而高度为两个编辑框的高度加上分数线的高度1。两个编辑框按居中对齐，如图：




 XXXX              XX
------          --------
 XXX            XXXXXX




在居中对齐时，如果不能正好对准，则往左偏半格，如上图左边的分母编辑框。




 
【光标控制】
 
应该指出，编辑框是可以层层嵌套的，比如一个编辑框内有一个矩阵，矩阵内又有若干个编辑框。我们说该编辑框比矩阵的编辑框高一级，矩阵内的所有编辑框同级，分式的两个编辑框也是同级的。注意：同级只是对一个矩阵或一个分式内的编辑框而言。
光标可以跳到编辑框的开始和末尾，也可以向四个方向移动，设光标所处的最低一级的编辑框为A。
 

如果光标跳到编辑框的开始（末尾），则把光标置于A的前端（末端）；

 
 

当光标上下移动时

n  如果A上(下)方有与A同级的编辑框B，则把光标置于B的前端，





示例


下移一次后




 XXXX|
------
  XX


XXXX
------
  |XX





n  否则对比A高一级的编辑框作同样判断，若A是最高级别的编辑框，则不作任何处理。如图，竖线代表光标：





示例


下移一次后


再下移一次后（不变）




  d
 ---
  |c
-----
  a
 ---
  b


  d
 ---
  c
-----
  a
 ---
  b


  d
 ---
  c
-----
  a
 ---
  b





 

当光标左（右）移动时

n  若光标位于A的前端(末端)，
u  如果左(右)边没有同级的编辑框，则光标将返回到更高一级的编辑框（若无则不作处理），置于矩阵或分式的左(右)边；
u  如果左(右)边有同级的编辑框B，则置于B的末端（前端）；





示例


左移一次后


再左移两次后




1+[B |A]


1+[B| A]


1+|[B A]





 
n  若光标左（右）边是一个矩阵或分式，
u  如果是分式，则光标置于分子编辑框的末端(前端)，





示例


左移一次后




 XXXX
------
  XX


XXXX|
------
  XX





 
u  如果是矩阵，则置于第m列行（第1列行）编辑框的末端(前端)；





示例


右移一次后




          612
[  456   -----]
          123
 
  65535
[-------  234 ]
    1
  -----
   255


          612
[  456   -----]
          123
 
  65535
[-------  234 ]
    1
  -----
   255





n  若光标左（右）边是其它元素，则光标左（右）移一格。
 
【输入控制】
 
程序通过一系列的事件来实现输入，每个事件已经被转化成一个字符串：
 
u  若字符串只含一个字符，则必为运算符、括号、数字或字母。此时程序在光标处插入该字符，然后光标右移一次；
u  若字符串为Matrix或Fraction，则在光标处插入一个的矩阵或分式，光标右移一次；
u  若字符串为AddRow或AddCol，则在矩阵内光标所处的编辑框前插入一行编辑行或一列编辑列，并把光标置于新插入的行（列）中，若光标不在任何矩阵内，则不作处理；
u  字符串Home、End、Left、Right、Up、Down则分别代表光标置于编辑框的开始、末尾，光标向左、右、上、下移动一次。
 
注意：由于该软件只用于输入表达式，并不对表达式进行任何处理，所以所输入的表达式可能并不正确。
你需要根据给定的输入，给出满足题意的输出：
l  输入中包括用如上所述格式所描述的操作序列。序列中可能包括运算符、括号、数字、字母、矩阵或分数的插入及光标的移动控制；
l  你需要根据输入的操作序列，完成对表达式的输入；我们约定初始时的表达式为空；
l  然后你需要在输出文件中用我们约定的格式打印出这个表达式。注意表达式行末不要有空格。
  

</pre>
  
  
## 输入描述：  

<pre>
每行有一个代表事件的字符串，直到文件结束。我们约定矩阵的规模不超过，总的元素个数不超过10,000。
</pre>
  
  
## 输出描述：  

<pre>
按规定的格式输出编辑框的结果，空白的地方用空格补上，每行行末不能有多余空格。最后一行行末保留一个回车。
</pre>
  
  
## 样例输入：  

<pre>
1  
+  
Fraction  
1  
Down  
1  
+  
Fraction  
1   
Down  
1  
+  
Fraction  
1  
Down  
x  
Up  
Up   
Right  
Right  
Home  
Up  
End  
+  
2  
-  
2
</pre>
  
  
## 样例输出：  

<pre>




                [1]
     1
 - 5---*[1 2 3]*[2]
     6
                [3]




</pre>
  
  
## 数据范围及提示：  

<pre>
见题面
</pre>
  
  
***  

##### AC: 46  
##### WA: 2  
##### TLE: 0  
##### MLE: 0  
##### RE: 1  
