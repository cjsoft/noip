# 4363 Mr.Li的公司   
### 时间限制： 3 s     空间限制： 256000 KB     题目等级： 钻石  
## 题目描述：  

<pre>
在物质发达A国首都，有着若干个公司。其中有着一个叫做WAKA的公司，这个公司的老板Mr.Li是你的中学同学，你来到他的公司，正准备好好玩耍时，Mr.Li抓住了你的手……事情是这样的，在他的公司中，有着n个员工，在这些员工之中，两两之间都有着“互利共赢”的关系，表示这两个员工可以在事业上互相帮助，而这样的关系一共有m条。当然，Mr.Li的员工都是些心高气傲的人，他们之间的互相帮助也是要收取代价的，并且他们觉得他们帮助过的人没有他们优越，而他们又绝对不会容忍不优越的人来帮助自己，即使代价很低。当然，在还没有互相帮助的时候，彼此之间的关系还是十分融洽的，并没有人觉得自己比别人优越。当然，Mr.Li的员工都是些很有才华的人，他们在公司之外结实了各种各样的人，如果向这人求取帮助所需花费可能更少。这样的帮助所需代价全都为d，这样的人很多，根本不愁找不到。当然，如果公司中也有代价为d且满足条件的人，则优先选择公司中的。一号总是那么臭屁，他只能容忍外援。当然，Mr.Li的员工都是些狡诈的人，他们在互相帮助后都会向上司提出要“报账”的申请，而公司希望所有员工都有人来帮助，因此公司的支出大大提高。Mr.Li满脸愁容的望着你，希望你给予他帮助。要求：在满足条件的情况下，求最小代价。这样就完了吗？当然没有。在Mr.Li的一再要求下，所有有关系的员工都组成一个块，统一管理，Mr.Li又给出了以下定义：【块】：几个或者一个员工有帮助关系，则统一起来，集合成一个块，统一处理。【块的和】：在一个块里的所有员工的代价和（当然是最优情况下）。【块的编号】：块的编号从1开始，之后依次递增，编号按照块中编号最小的员工的编号来编号。【块的最小值】：块中员工的代价的最小值。【Mr.Li和】：对于一段个数为n的块区间，有∑（i=1 i<=n）∑(j=1 j<=C(i-1,n-1)) (-1)^(i+n) ∏(k=1;k<=i) aq(q∈[1,n])  (没有图片我也很痛苦啊，试了好久都不行)如：n=1 展开为 a1。     n=2 展开为 a1a2-a1-a2。其中，每个组合中aq不重复，每一个组合不重复。其中，aq为块的和，a1a2a3和a2a3a1算作重复。在这样的定义下，有了这样几个操作：M ：a  c   块a的所有员工代价都加上c,最小值也相应变化。A ：a  b  查询块区间[a,b]上的块的和的和。由于其值很大，要mod 1000000007Q ：a  b  查询块区间[a,b]中员工代价的最小值。Y ：a  b  查询块区间[a,b]中的Mr.Li和。由于其值很大，要mod 1000000007  

</pre>
  
  
## 输入描述：  

<pre>
第一行有三个整数n,m,d。表示人数，关系数和外援代价。其后m行每行有三个整数a,b,c。表示a,b可以互相帮助，代价为c。即：a帮助b为c；b帮助a也为c。之后一行一个整数k,表示操作个数，之后k行分别为一个操作。  

</pre>
  
  
## 输出描述：  

<pre>
对于每一个询问，输出一个答案，一个答案一行，输出完毕后，有一个多余的空行。
</pre>
  
  
## 样例输入：  

<pre><code>
6   8   41   2   11   3   72   3   42   4   52   5   33   5   24   6   25   6   79Q   1   2A   1   2Q   2   2Y   1   2M   1   2Q   1   2Q   2   2A   1   1Y   2   2  

</code></pre>
  
  
## 输出输出：  

<pre><code>
11624422186  

</code></pre>
  
  
## 数据范围及提示：  

<pre>
对于10%的数据：0<=n<=100 , 0<=m<=1000 , 0<=k<=100。对于30%的数据：0<=n<=1000 , 0<=m<=10000 , 0<=k<=1000。对于另外10%的数据：没有Y操作。对于另外10%的数据：没有M操作。对于另外10%的数据：没有Y和M操作。对于另外10%的数据：只有一个块。0<=n<=500000, 0<=m<=700000, 0<=k<=700000。对于其余数据：0<=n<=200000 , 0<=m<=400000 ，0<=k<=300000(除了只有一个块的数据)。对于100%的数据：0<=n<=500000 , 0<=m<=700000 ，0<=k<=700000 , 0<=a,b<=n ，0<c,d<=1000000000。  

</pre>
  
  
***  

##### AC: 2  
##### WA: 15  
##### TLE: 0  
##### MLE: 0  
##### RE: 0  
